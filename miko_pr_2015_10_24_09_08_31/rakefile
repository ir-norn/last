# -*- encoding: UTF-8 -*-

$dir = File.dirname(__FILE__)+"/"
$dir.gsub!("/","\\\\")

def func
  db_file = "./__DEBUG_MODE__.rb"
  open( db_file , "w") do | f |
    f.print "$__DEBUG_MODE__ = :compile"
  end
  
  yield
  
  File.unlink db_file
end
def backup
  `ruby "#{$dir}__backup.rb"`
end

# --------------------- rake --------------------------

task :default do | o |
 p :deff
end

# build
task :compile do | o |
  func do
    sh"ocra last.rb --icon dat/icon/icon.ico"
  end
end

# mehod ka suru
[ :backup_compile , :bc ].each do | cmd |
  task cmd do | o |
    func do
      backup
      sh"ocra last.rb --icon dat/icon/icon.ico"
    end
  end
end
task :backup do | o |
  backup
end

# hikisu

task :aa , [ "id" , "pass" ] do | o  , argv |
#  if argv.size != 2
  if argv.id.nil? || argv.pass.nil?
    puts "0 --- id"
    puts "1 --- pass"
    exit
  end
  dir =  File.dirname(__FILE__)
  dir.gsub!("/","\\")
p dir
  `lhaz /c "#{dir}"`
p  dir2 =  File.dirname( dir )
p  ct   = File.basename( dir )
p  t = Time.now.strftime("%Y_%m_%d_%H_%M_%S")
p  back_file =  "mikomiu__#{t}.zip"
p  %!ren "#{dir2}\\#{ct}.zip"  "#{back_file}"!
  `ren "#{dir2}\\#{ct}.zip"  "#{back_file}"`

# start de kidousuruto  zip
# start nasi dato lzh datta
#  `start ruby sc\\atpage_ftp.rb #{argv.id} #{argv.pass} "#{dir2}\\xxx.txt"`
  `start ruby sc\\atpage_ftp.rb #{argv.id} #{argv.pass} "#{dir2}\\#{back_file}"`
end



task :ord do | o |
  t = Time.now.strftime("%Y_%m_%d_%H_%M_%S")
  dir  = File.basename File.dirname __FILE__
  xdir = "C:\\Ruby193\\lib\\ruby\\1.9.1\\__test\\"
  miko = "miko_Last_#{t}"
  db_file = "./__DEBUG_MODE__.rb"
  open( db_file , "w") do | f |
    f.print "$__DEBUG_MODE__ = :compile"
  end
  puts "..\\#{dir} #{xdir}"
  `xcopy ..\\#{dir} #{xdir} /E /Y`

# png だめぽい  拡張子は .ico
#  `ocra last.rb --windows --icon icon/0.ico`
   puts " -- compile -- "

  `ocra last.rb --icon dat/icon/icon.ico`

   puts " -- compiled -- "

  `move .\\last.exe #{xdir}last.exe`

   File.unlink db_file
#  puts " -- program start -- "
#  `#{xdir}last.exe`
end

task :name do | o |
  p 3

end


#t = Time.now.strftime("%Y_%m_%d_%H_%M_%S")
#dir = File.basename File.dirname __FILE__

#puts "backup_start..."

#miko = "miko_Last_"

#`mkdir ..\\#{ miko }#{ t }`
#`xcopy ..\\#{dir} ..\\#{ miko }#{ t } /E /Y`

#puts "complate..."


